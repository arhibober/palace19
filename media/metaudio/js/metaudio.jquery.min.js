window.metaudio={init:function(h){swfobject.embedSWF(h,"metaudio-placeholder","1","1","10.1",!1,{},{menu:!1,scale:"noScale",allowScriptAccess:"always"},{id:"metaudio-player",name:"metaudio-player"},function(h){if(h.ref)window.metaudio={player:h.ref,sounds:{},create:function(a){var d=this.player,f=function(){};d.mpCreate(a.url);var h={url:a.url,loading:!0,playing:!1,play:function(){d.mpPlay(this.url)},stop:function(){d.mpStop(this.url)},resume:function(){d.mpResume(this.url)},pause:function(){d.mpPause(this.url)},
getBytesTotal:function(){return d.mpGetBytesTotal(this.url)},getBytesLoaded:function(){return d.mpGetBytesLoaded(this.url)},getDuration:function(){return d.mpGetDuration(this.url)},getPosition:function(){return d.mpGetPosition(this.url)},setPosition:function(a){d.mpSetPosition(this.url,a)}};f={onload:f,onplay:f,onstop:f,onresume:f,onpause:f,onfinish:f,onseek:f,whileplaying:f,whileloading:f};for(var i in f)h[i]=a[i]?a[i]:f[i];return this.sounds[a.url]=h},pauseAllBut:function(a){for(var d in this.sounds)d!=
a&&this.sounds[d].pause()},onload:function(a){this.sounds[a].onload()},onplay:function(a){a=this.sounds[a];a.playing=!0;a.onplay()},onstop:function(a){a=this.sounds[a];a.playing=!1;a.onstop()},onresume:function(a){a=this.sounds[a];a.playing=!0;a.onresume()},onpause:function(a){a=this.sounds[a];a.playing=!1;a.onpause()},onfinish:function(a){a=this.sounds[a];a.playing=!1;a.onfinish()},onseek:function(a,d){this.sounds[a].onseek(d)},getPeak:function(){return this.player.mpGetPeak()},getWaveform:function(){return this.player.mpGetWaveform()},
savePeak:function(){this.peakData=this.getPeak()},saveWaveform:function(){this.waveformData=this.getWaveform()},poll:function(){var a=this.sounds,d;for(d in a){var f=a[d];f.playing&&f.whileplaying();if(f.loading){f.whileloading();var h=f.getBytesTotal(),i=f.getBytesLoaded();if(h>0&&i>=h)f.loading=!1}}}},this.interval=setInterval(function(){window.metaudio.poll()},100)})}};
function metaudioPlayer(h){function l(a){return Math.floor(a/6E4)+":"+("0"+Math.floor(a%6E4/1E3)).slice(-2)}function a(a,b){var c=b?b.getBytesTotal():0;c=c?b.getBytesLoaded()/c:0;var g=b?b.getDuration():0;e(".metaudio-loading",a).css({width:100*c+"%"});e(".metaudio-total",a).text(g?l(g):"-:--")}function d(a,b,c){b&&b.getBytesTotal();b=b?b.getDuration():0;b=c&&b?c/b:0;e(".metaudio-position",a).css({width:100*b+"%"});e(".metaudio-current",a).text(c?l(c):"-:--")}function f(a){function b(a,g){if(g.length>
0){var c=e(a.canvas).width(),b=e(a.canvas).height();a.beginPath();a.moveTo(0,(b*g[0]+b)/2);for(var d=1;d<256;d++)a.lineTo(d*c/256,(b*g[d]+b)/2);a.stroke();a.closePath()}}var c=a.canvas;a.clearRect(0,0,c.width,c.height);var g=window.metaudio.waveformData;if(g)a.save(),c=e(c).parent().hasClass("metaudio-swap"),a.lineWidth="1",a.strokeStyle="#9cf",b(a,c?g.right:g.left),a.strokeStyle="#000",b(a,c?g.left:g.right),a.restore()}function o(a){a=e("canvas:first",a);return a.size()&&a[0].getContext?a[0].getContext("2d"):
null}function i(a){return window.metaudio.sounds[e(a).siblings("a:first").attr("href")]}function n(a,b){var c=e(a);c=(b.pageX-c.offset().left)/c.width();var g=i(a);if(g&&(g=g.getDuration()))return Math.floor(c*g);return 0}window.metaudio.init(h.swfurl);if(typeof jQuery!="undefined"){var e=jQuery;h=e.extend({autoPlayNext:!1},h);e(function(){if(typeof window.metaudio.create!="undefined"){var j=e('<div class="metaudio-tooltip" />').appendTo("body"),b=e("a.metaudio-player");b.after('<div class="metaudio-timing"><span class="metaudio-current">-:--</span> / <span class="metaudio-total">-:--</span></div><div class="metaudio-peak"><div><div class="metaudio-left" /><div class="metaudio-right" /></div></div><div class="metaudio-spectrogram" /><div class="metaudio-control" /><div class="metaudio-statusbar"><div class="metaudio-loading" /><div class="metaudio-position" /></div>');
e(".metaudio-spectrogram").each(function(){var a=document.createElement("canvas");a.width=256;a.height=20;var b=window.G_vmlCanvasManager;b&&b.initElement(a);e(this).append(a)}).click(function(){e(this).toggleClass("metaudio-swap");var a=o(this);if(a)return f(a),!1});e(".metaudio-statusbar",b.parent()).click(function(a){a=n(this,a);var b=i(this);b&&b.setPosition(a);return!1}).mousemove(function(a){var b=e(this);j.offset({left:a.pageX+20,top:b.offset().top+b.height()+10}).text(l(n(this,a))).show()}).mouseout(function(){j.hide().empty()});
var c=b.closest("li");c.find("a").not(b).click(function(a){a.stopPropagation()});b.click(function(a){a.preventDefault()});a(c);d(c);c.click(function(){var b=e(this),i=e("a:first",b).attr("href"),j=o(b);window.metaudio.pauseAllBut(i);c.not(b).removeClass("sm2_active");var k=window.metaudio.sounds[i];k||(k=window.metaudio.create({url:i,usePeakData:!0,useWaveformData:!!j,onload:function(){a(b,this)},onplay:function(){b.addClass("sm2_playing")},onstop:function(){b.removeClass("sm2_playing sm2_paused")},
onpause:function(){b.removeClass("sm2_playing");b.addClass("sm2_paused")},onresume:function(){b.removeClass("sm2_paused");b.addClass("sm2_playing")},onfinish:function(){b.removeClass("sm2_playing sm2_paused");d(b);h.autoPlayNext&&b.next().addClass("sm2_active").click()},onseek:function(a){d(b,this,a)},whileloading:function(){a(b,this)},whileplaying:function(){d(b,this,this.getPosition());window.metaudio.savePeak();var a=window.metaudio.peakData,c=e(".metaudio-peak",b);a?(e(".metaudio-left",c).css("height",
100*a.left+"%"),e(".metaudio-right",c).css("height",100*a.right+"%")):c.children().css("height",0);j&&(window.metaudio.saveWaveform(),f(j))}}));b.hasClass("sm2_active")&&(b.hasClass("sm2_paused")?k.resume():b.hasClass("sm2_playing")?k.pause():k.play());b.addClass("sm2_active")})}});if(document.all){var m=function(){var a=document.all["metaudio-player"];a&&a.removeNode(!0)};window.addEventListener?window.addEventListener("unload",m,!1):window.attachEvent?window.attachEvent("onunload",m):window.unload=
m}}};
